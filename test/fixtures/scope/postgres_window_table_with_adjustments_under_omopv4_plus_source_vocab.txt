SELECT * FROM (WITH "icd9_\d+_1_\w+" AS MATERIALIZED (SELECT * FROM (SELECT "l".*, "r"."window_id" FROM (SELECT * FROM (SELECT "person_id" AS "person_id", "condition_occurrence_id" AS "criterion_id", CAST('condition_occurrence' AS text) AS "criterion_table", CAST('condition_occurrence' AS text) AS "criterion_domain", CAST("condition_start_date" AS date) AS "start_date", CAST(coalesce("condition_end_date", "condition_start_date") AS date) AS "end_date", CAST("condition_source_value" AS text) AS "source_value", CAST("condition_source_vocabulary_id" AS text) AS "source_vocabulary_id", CAST(NULL AS text) AS "label" FROM "condition_occurrence" WHERE (("condition_source_vocabulary_id" = 2) AND ("condition_source_value" IN ('412')))) AS "t1") AS "l" INNER JOIN (SELECT "person_id", "start_date", "end_date", row_number() OVER (ORDER BY "person_id", "start_date", "end_date") AS "window_id" FROM "jtemp" GROUP BY "person_id", "start_date", "end_date") AS "r" ON (("l"."person_id" = "r"."person_id") AND (CAST((CAST("r"."start_date" AS timestamp) + make_interval(days := -30)) AS date) <= "l"."start_date") AND ("l"."start_date" <= CAST((CAST("r"."end_date" AS timestamp) + make_interval(months := 1)) AS date)))) AS "t1") SELECT * FROM "icd9_\d+_1_\w+") AS "t1"