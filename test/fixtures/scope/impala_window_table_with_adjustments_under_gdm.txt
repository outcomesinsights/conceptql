SELECT * FROM (SELECT * FROM (SELECT `l`.*, `r`.`window_id` FROM (SELECT * FROM (SELECT `patient_id` AS `person_id`, `id` AS `criterion_id`, CAST('clinical_codes' AS string) AS `criterion_table`, CAST('condition_occurrence' AS string) AS `criterion_domain`, `start_date`, `end_date`, CAST(`clinical_code_source_value` AS string) AS `source_value`, CAST(`clinical_code_vocabulary_id` AS string) AS `source_vocabulary_id` FROM `clinical_codes` WHERE (`clinical_code_concept_id` IN (SELECT `id` FROM `concepts` WHERE ((`vocabulary_id` = 'ADMSRCE') AND (`concept_code` IN ('12')))))) AS `t1`) AS `l` INNER JOIN (SELECT *, row_number() OVER (ORDER BY ) AS `window_id` FROM `jtemp`) AS `r` ON ((CAST((CAST(`r`.`start_date` AS timestamp) + INTERVAL -30 days) AS timestamp) <= `l`.`start_date`) AND (`l`.`end_date` <= CAST((CAST(`r`.`end_date` AS timestamp) + INTERVAL 1 months) AS timestamp)) AND (`l`.`person_id` = `r`.`person_id`))) AS `t1`) AS `t1`