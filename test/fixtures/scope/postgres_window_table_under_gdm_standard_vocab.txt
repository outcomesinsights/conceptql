SELECT * FROM (SELECT * FROM (SELECT "l".*, "r"."window_id" FROM (SELECT * FROM (SELECT "patient_id" AS "person_id", "id" AS "criterion_id", CAST('clinical_codes' AS text) AS "criterion_table", CAST('procedure_occurrence' AS text) AS "criterion_domain", "start_date", "end_date", CAST("clinical_code_source_value" AS text) AS "source_value", CAST("clinical_code_vocabulary_id" AS text) AS "source_vocabulary_id" FROM "clinical_codes" WHERE ("clinical_code_concept_id" IN (SELECT "id" FROM "concepts" WHERE (("vocabulary_id" = 'CPT4') AND ("concept_code" IN ('99214')))))) AS "t1") AS "l" INNER JOIN (SELECT "person_id", "start_date", "end_date", row_number() OVER (ORDER BY "person_id", "start_date", "end_date") AS "window_id" FROM "jtemp" GROUP BY "person_id", "start_date", "end_date") AS "r" ON (("l"."person_id" = "r"."person_id") AND ("r"."start_date" <= "l"."start_date") AND ("l"."start_date" <= "r"."end_date"))) AS "t1") AS "t1"